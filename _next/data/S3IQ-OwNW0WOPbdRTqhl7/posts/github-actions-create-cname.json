{"pageProps":{"post":{"title":"【GitHub Pages】カスタムドメインがリセットされちゃうのよぉ！","date":"2022-03-26T05:35:07.322Z","slug":"github-actions-create-cname","author":{"name":"Pento","picture":"/assets/blog/authors/jj.jpeg"},"content":"<p>このブログはGitHub Pagesを利用して配信しているのですが、配信するたびにカスタムドメイン設定がリセットされるため困っていました。\n再設定は簡単なのでまあいいかと思っていましたが、記事の投稿、サイトの改修頻度が上がるにつれて煩わしくなってきたのでようやく重い腰を上げて修正しました。</p>\n<p>下記のように毎度設定が空に\n<img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_1.png\" alt=\"GitHub Pagesセッティング\"></p>\n<p>そもそも都度設定をしなきゃいけないわけないので確実に設定漏れ。とりあえずGitHub Pagesの<a href=\"https://docs.github.com/ja/pages/configuring-a-custom-domain-for-your-github-pages-site/troubleshooting-custom-domains-and-github-pages\">トラブルシューティング</a>を確認</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_2.png\" alt=\"GitHubリファレンス\"></p>\n<p>ど頭にあったw 確認ミスも確認ミス。</p>\n<blockquote>\n<p>サイトが正しいドメインをレンダリングするには、CNAME ファイルがまだリポジトリに存在していることを確認します。 たとえば、静的サイトジェネレータの多くはリポジトリへのプッシュを強制するので、カスタムドメインの設定時にリポジトリに追加された CNAME ファイルを上書きすることができます。 ローカルでサイトをビルドし、生成されたファイルを GitHub にプッシュする場合は、CNAME ファイルをローカルリポジトリに追加したコミットを先にプルして、そのファイルがビルドに含まれるようにする必要があります。</p>\n</blockquote>\n<p>とりあえずCNAMEファイルというのが生成されて、GitHub Pages対象のブランチ(デフォルトはgh-pages)に存在する必要があるみたい。</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_3.png\" alt=\"GitHubリポジトリ\"></p>\n<p>ホントだ。ない...</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_4.png\" alt=\"GitHubコミット履歴\"></p>\n<p>コミット履歴にはある...</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_5.png\" alt=\"GitHubコミット履歴詳細\"></p>\n<p>純粋にCNAMEというファイル名にドメイン記載したものがgh-pagesブランチにあれば良いのか</p>\n<blockquote>\n<p>CNAMEファイルをローカルリポジトリに追加したコミットを先にプルして、そのファイルがビルドに含まれるようにする必要があります。</p>\n</blockquote>\n<p>の部分がGitHub Actions内でやらなくてはならない感じもするけど、とりあえずファイル存在すればOKでしょうということで作成して普通にmerge</p>\n<p>このサイトはNEXT.jsのブログテンプレートを利用しているのでpublic/配下に配置すれば静的ファイルとしてデプロイ後のルートディレクトリに配置されるはず</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_6.png\" alt=\"GitHubリポジトリ設定後\">\nOK！</p>\n<p><img src=\"/assets/blog/github-actions-create-cname/github-actions-create-cname_7.png\" alt=\"GitHub Pagesセッティング後\">\n設定の方もOK</p>\n<p>まとめ\nGitHubのトラブルシューティングは優秀</p>\n","ogImage":{"url":"/assets/blog/dynamic-routing/cover.jpg"},"coverImage":"/assets/blog/dynamic-routing/cover.jpg"}},"__N_SSG":true}